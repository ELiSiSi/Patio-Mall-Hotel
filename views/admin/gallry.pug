extends base

block content
  main.admin-main

    //- ===== PAGE TITLE =====
    .page-title-bar
      .page-title-info
        h1
          i(class="fa-solid fa-images" style="margin-left:10px; color:#a855f7;")
          | Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±
        p.page-subtitle Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø°Ù ØµÙˆØ± Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø§ØªÙŠÙˆ Ù…ÙˆÙ„

      button.add-room-btn(onclick="openAddModal()" style="background:linear-gradient(135deg,#a855f7,#7c3aed); box-shadow:0 6px 20px rgba(168,85,247,0.4);")
        i(class="fa-solid fa-plus")
        span Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©

    //- ===== STATS =====
    .stats-grid
      .stat-card.stat-total
        .stat-icon(style="background:rgba(168,85,247,0.15); color:#a855f7;")
          i(class="fa-solid fa-images")
        .stat-info
          span.stat-label Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙˆØ±
          span.stat-value= gallries.length

      .stat-card.stat-confirmed
        .stat-icon
          i(class="fa-solid fa-photo-film")
        .stat-info
          span.stat-label Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø¶Ø§ÙØ©
          span.stat-value= gallries.length

      .stat-card.stat-pending
        .stat-icon
          i(class="fa-solid fa-eye")
        .stat-info
          span.stat-label Ø¸Ø§Ù‡Ø±Ø© ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹
          span.stat-value
            if gallries.length > 0
              | Ù†Ø¹Ù… âœ“
            else
              | Ù…Ø®ÙÙŠØ©

      .stat-card.stat-cancelled
        .stat-icon
          i(class="fa-solid fa-cloud-arrow-up")
        .stat-info
          span.stat-label Ø¢Ø®Ø± Ø¥Ø¶Ø§ÙØ©
          span.stat-value
            if gallries.length > 0
              | #{gallries.length} ØµÙˆØ±Ø©
            else
              | â€”

    //- ===== GALLERY GRID =====
    if gallries.length === 0
      .empty-state(style="background:#1a1d27; border-radius:14px; border:1px solid rgba(255,255,255,0.07);")
        i(class="fa-solid fa-images" style="opacity:0.3; color:#a855f7;")
        p Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± ÙÙŠ Ø§Ù„Ù…Ø¹Ø±Ø¶ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†
        button.add-room-btn(onclick="openAddModal()" style="margin:16px auto 0; display:inline-flex; background:linear-gradient(135deg,#a855f7,#7c3aed);")
          i(class="fa-solid fa-plus")
          span Ø£Ø¶Ù Ø£ÙˆÙ„ ØµÙˆØ±Ø©
    else
      .gallery-admin-grid#galleryGrid
        each gallry, index in gallries
          .gallery-admin-card(data-id=gallry._id)
            .gallery-admin-img
              img(src=gallry.image alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ø±Ø¶" loading="lazy")
              .gallery-admin-num= index + 1
              .gallery-admin-actions
                a.gal-btn.gal-btn-view(href=gallry.image target="_blank" title="Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©")
                  i(class="fa-solid fa-expand")
                button.gal-btn.gal-btn-delete(title="Ø­Ø°Ù" onclick=`deleteGallery('${gallry._id}')`)
                  i(class="fa-solid fa-trash")

    //- ===== MODAL â€” ADD IMAGE =====
    #galleryModal.modal-overlay(style="display:none;")
      .modal-card
        .modal-header
          h3
            i(class="fa-solid fa-image" style="margin-left:8px; color:#a855f7;")
            | Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
          button.modal-close(onclick="closeModal()")
            i(class="fa-solid fa-xmark")

        .modal-body
          //- URL input
          .form-group
            label(for="imageUrl")
              i(class="fa-solid fa-link" style="margin-left:6px; color:#a855f7;")
              | Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (URL) *
            .input-with-icon
              input#imageUrl.form-input(
                type="url"
                placeholder="https://example.com/photo.jpg"
                oninput="previewImage()"
              )
              i(class="fa-solid fa-link input-icon")

          //- Preview
          #previewWrap.gal-preview-wrap(style="display:none;")
            p.gal-preview-label Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©
            .gal-preview-box
              img#previewImg(src="" alt="Ù…Ø¹Ø§ÙŠÙ†Ø©")
              .gal-preview-check
                i(class="fa-solid fa-circle-check")
                span Ø§Ù„ØµÙˆØ±Ø© ØªØ¨Ø¯Ùˆ Ù…Ù…ØªØ§Ø²Ø©!

          .modal-actions
            button.modal-action-btn(type="button" onclick="saveImage()" style="background:rgba(168,85,247,0.15); color:#a855f7; border:1px solid #a855f7;")
              i(class="fa-solid fa-floppy-disk")
              span Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©
            button.modal-action-btn.btn-modal-cancel(type="button" onclick="closeModal()")
              i(class="fa-solid fa-xmark")
              span Ø¥Ù„ØºØ§Ø¡

    //- ===== TOAST =====
    #toast-container

  script.
    // â”€â”€ Toast â”€â”€
    function showToast(message, type = 'info') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      const icons = { error:'fa-circle-exclamation', warning:'fa-triangle-exclamation', success:'fa-circle-check', info:'fa-circle-info' };
      toast.innerHTML = `<div class="toast-content"><i class="fa-solid ${icons[type]} toast-icon"></i><span class="toast-message">${message}</span></div><div class="toast-progress"></div>`;
      container.appendChild(toast);
      setTimeout(() => toast.classList.add('show'), 10);
      setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, 4000);
    }

    // â”€â”€ Open / Close Modal â”€â”€
    function openAddModal() {
      document.getElementById('imageUrl').value = '';
      document.getElementById('previewWrap').style.display = 'none';
      document.getElementById('previewImg').src = '';
      document.getElementById('galleryModal').style.display = 'flex';
      setTimeout(() => document.getElementById('imageUrl').focus(), 100);
    }

    function closeModal() {
      document.getElementById('galleryModal').style.display = 'none';
    }

    document.getElementById('galleryModal').addEventListener('click', e => {
      if (e.target === document.getElementById('galleryModal')) closeModal();
    });

    // â”€â”€ Preview Image â”€â”€
    function previewImage() {
      const url = document.getElementById('imageUrl').value.trim();
      const wrap = document.getElementById('previewWrap');
      const img  = document.getElementById('previewImg');

      if (!url) { wrap.style.display = 'none'; return; }

      img.onload  = () => { wrap.style.display = 'block'; };
      img.onerror = () => { wrap.style.display = 'none'; };
      img.src = url;
    }

    // â”€â”€ Save Image â”€â”€
    async function saveImage() {
      const url = document.getElementById('imageUrl').value.trim();
      if (!url) { showToast('ğŸ”— Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©', 'warning'); return; }

      try {
        const res = await fetch('/api/v1/gallry', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ image: url })
        });
        if (res.ok) {
          showToast('âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ù…Ø¹Ø±Ø¶', 'success');
          closeModal();
          setTimeout(() => location.reload(), 1200);
        } else {
          const err = await res.json().catch(() => ({}));
          showToast('âŒ ' + (err.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£'), 'error');
        }
      } catch { showToast('âŒ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error'); }
    }

    // â”€â”€ Delete Image â”€â”€
    async function deleteGallery(id) {
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶ØŸ')) return;
      try {
        const res = await fetch(`/api/v1/gallry/${id}`, { method: 'DELETE' });
        if (res.ok) {
          showToast('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©', 'success');
          setTimeout(() => location.reload(), 1000);
        } else {
          showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù', 'error');
        }
      } catch { showToast('âŒ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„', 'error'); }
    }

    // â”€â”€ Keyboard â”€â”€
    document.addEventListener('keydown', e => {
      if (e.key === 'Enter' && document.getElementById('galleryModal').style.display === 'flex') saveImage();
      if (e.key === 'Escape') closeModal();
    });
